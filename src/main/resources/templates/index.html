<!DOCTYPE html>
<meta name="referrer" content="no-referrer"/>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>知乎SpiderMan</title>
    <script th:src="@{/js/jquery-3.4.1.js}" type="text/javascript"></script>
    <script th:src="@{/js/jquery.lazyload.min.js}" type="text/javascript"></script>
    <script th:src="@{/js/bootstrap.min.js}" type="text/javascript"></script>
    <link th:href="@{/css/bootstrap.min.css}" type="text/css" rel="stylesheet"/>
</head>
<script>

    function spiderManRun() {
        var questionId = $("#questionId").val();
        $.ajax({
            type: "GET",
            url: "/spider/" + questionId,
            success: function (data) {
                var photoContainer = $("#photoContainer");
                if (data == null) {
                    var innerHtml = "<span>┗|｀O′|┛ 嗷~~没有图片鸭！</span>";
                    photoContainer.html(innerHtml);
                    return;
                }
                var urlList = data;
                console.log(urlList);
                var photoContent = "";
                for (var i = 0; i < urlList.length; i++) {
                    var url = urlList[i];
                    photoContent += "<div class='pic'><img class='lazyImage' src='/img/loading.jpg' data-original='" + url + "'> </img></div>";
                }
                photoContainer.html(photoContent);
                $(".lazyImage").lazyload({
                    threshold: 200,
                    effect: "fadeIn"
                });
                waterFall();
            }
        })
    }


    function waterFall() {
        // 1- 确定图片的宽度 - 滚动条宽度
        var pageWidth = getClient().width - 8;
        var columns = 6; //3列
        var itemWidth = parseInt(pageWidth / columns); //得到item的宽度
        $(".pic").width(itemWidth); //设置到pic的宽度

        var arr = [];

        $(".spider_man .pic").each(function (i) {
            var height = $(this).find("img").height();
            var width = $(this).find("img").width();
            var bi = itemWidth / width; //获取缩小的比值
            var boxheight = parseInt(height * bi); //图片的高度*比值 = pic的高度

            if (i < columns) {
                // 2- 确定第一行
                $(this).css({
                    top: 0,
                    left: (itemWidth) * i
                });
                arr.push(boxheight);

            } else {
                // 其他行
                // 3- 找到数组中最小高度  和 它的索引
                var minHeight = arr[0];
                var index = 0;
                for (var j = 0; j < arr.length; j++) {
                    if (minHeight > arr[j]) {
                        minHeight = arr[j];
                        index = j;
                    }
                }
                // 4- 设置下一行的第一个盒子位置
                // top值就是最小列的高度
                $(this).css({
                    top: arr[index],
                    left: $(".spider_man .pic").eq(index).css("left")
                });

                // 5- 修改最小列的高度
                // 最小列的高度 = 当前自己的高度 + 拼接过来的高度
                arr[index] = arr[index] + boxheight;
            }
        });
    }

    //clientWidth 处理兼容性
    function getClient() {
        return {
            width: window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth,
            height: window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight
        }
    }


    // 页面尺寸改变时实时触发
    window.onresize = function () {
        //重新定义瀑布流
        waterFall();
    };

</script>
<style>
    .i_am {
        padding-top: 1%;
        padding-left: 1%;
    }

    .spider_man {
        width: 100%;
        /*margin-top: 50px;*/
        position: relative;
    }

    .pic {
        z-index: 10;
        transition: 0.25s;
        overflow: hidden;
        position: absolute;
    }

    .pic img {
        width: 100%;
        height: 100%;
        transition: 0.25s;
    }

    .pic:hover img {
        z-index: 100;
        transition: 0.25s;
        overflow: hidden;
        animation: bounceIn 0.25s ease-in 2 alternate;
    }

    @keyframes bounceIn {
        100% {
            transform: scale(1.07);
        }
    }
</style>
<body>
<div class="i_am">
    <input type="text" id="questionId" class="questionId" placeholder="请输入问题id">
    <button id="spiderManRun" class="btn-info" style="border-radius:4px" onclick="spiderManRun();">Spider Man Run!
    </button>
</div>
<hr>
<div class="spider_man" id="photoContainer">

</div>
</body>
</html>